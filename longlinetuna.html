<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Viability: Long Line Tuna Liners (Andaman EEZ)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <!-- Tailwind Config for Custom Palette -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        stone: {
                            50: '#fafaf9',
                            100: '#f5f5f4',
                            200: '#e7e5e4',
                            800: '#292524',
                            900: '#1c1917',
                        },
                        ocean: {
                            light: '#7dd3fc', // sky-300
                            DEFAULT: '#0284c7', // sky-600
                            dark: '#0c4a6e', // sky-900
                        },
                        tuna: {
                            red: '#be123c', // rose-700
                        },
                        profit: {
                            DEFAULT: '#d97706', // amber-600
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'Segoe UI', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Styles for Chart Containers as per requirements */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 650px; /* Max width to prevent excessive stretching */
            margin-left: auto;
            margin-right: auto;
            height: 350px; /* Base height */
            max-height: 400px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }

        /* Smooth scrolling for navigation */
        html {
            scroll-behavior: smooth;
        }

        /* Custom scrollbar for data tables */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #d6d3d1;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #a8a29e;
        }
        
        /* Active Tab State */
        .nav-tab.active {
            border-bottom: 2px solid #0284c7;
            color: #0c4a6e;
            font-weight: 600;
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800 font-sans antialiased selection:bg-ocean-light selection:text-ocean-dark">

    <!-- 
    ========================================================================
    PLACEHOLDER COMMENTS
    ========================================================================
    -->

    <!-- Chosen Palette: Warm Neutrals (Stone/Sand) with Deep Ocean Blue and Tuna Red accents. This creates a professional, serious, yet maritime atmosphere suitable for an investment feasibility report. -->

    <!-- Application Structure Plan: 
         The app uses a vertical narrative flow ("Scrollytelling") combined with a sticky top navigation for quick access. 
         1. **Executive Dashboard (Hero):** Immediate high-level summary of the opportunity (IRR, NPV) to grab investor attention.
         2. **Resource & Market:** Visualizes the "Why" - Stock availability in Andaman EEZ and global price trends.
         3. **Operational Dynamics:** Explains the "How" - Vessel specs and catch composition.
         4. **Financial Simulator (The Core):** An interactive calculator allowing users to adjust Fuel Price, Catch Rate, and Sale Price. This is crucial for "Viability" analysis as these are the volatile variables. It updates a P&L projection dynamically.
         5. **Risk Analysis:** A heatmap (Plotly) showing sensitivity analysis, crucial for due diligence.
         6. **Conclusion:** Final recommendation.
         This structure moves from "Attraction" -> "Validation" -> "Viability" -> "Risk Assessment", a logical flow for business decision-making.
    -->

    <!-- Visualization & Content Choices:
         1. **Resource Potential (Chart.js Bar):** Goal: Show under-exploitation. Method: Comparison of Sustainable Yield vs Current Catch. Interaction: Tooltip details.
         2. **Catch Composition (Chart.js Doughnut):** Goal: Revenue quality. Method: Breakdown of high-value vs low-value catch. Interaction: Toggle segments.
         3. **Financial Projections (Chart.js Line/Bar Combo):** Goal: Long-term viability. Method: 10-year cash flow. Interaction: Updates based on the "Simulator" inputs.
         4. **Sensitivity Heatmap (Plotly):** Goal: Risk visualization. Method: 2D matrix of Fuel Price vs Catch Rate impacting ROI. Interaction: Hover for precise data points.
         5. **Operational Flow (HTML/CSS):** Goal: Explain logistics. Method: Step-by-step cards with unicode icons.
         Confirming NO SVG graphics used. NO Mermaid JS used.
    -->

    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->


    <!-- Navigation -->
    <nav class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-stone-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex-shrink-0 flex items-center gap-2 cursor-pointer" onclick="window.scrollTo(0,0)">
                    <span class="text-2xl text-ocean">‚öì</span>
                    <span class="font-bold text-xl tracking-tight text-stone-900">Andaman Tuna Project</span>
                </div>
                <div class="hidden md:flex space-x-8">
                    <button onclick="navigateTo('dashboard')" class="nav-tab active px-3 py-2 text-sm font-medium text-stone-500 hover:text-stone-900 transition-colors">Dashboard</button>
                    <button onclick="navigateTo('market')" class="nav-tab px-3 py-2 text-sm font-medium text-stone-500 hover:text-stone-900 transition-colors">Resource & Market</button>
                    <button onclick="navigateTo('financials')" class="nav-tab px-3 py-2 text-sm font-medium text-stone-500 hover:text-stone-900 transition-colors">Financial Simulator</button>
                    <button onclick="navigateTo('risks')" class="nav-tab px-3 py-2 text-sm font-medium text-stone-500 hover:text-stone-900 transition-colors">Risk Analysis</button>
                </div>
                <!-- Mobile menu button stub -->
                <div class="md:hidden">
                    <button class="text-stone-500 hover:text-stone-900">‚ò∞</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-16">

        <!-- SECTION 1: Executive Dashboard (Hero) -->
        <section id="dashboard" class="animate-fade-in">
            <div class="text-center mb-10">
                <h1 class="text-4xl font-extrabold text-stone-900 sm:text-5xl mb-4">
                    Viability of Long Line Tuna Operations
                </h1>
                <p class="text-xl text-stone-600 max-w-3xl mx-auto">
                    A feasibility study on deploying 24m Tuna Long Liners in the Andaman & Nicobar EEZ. 
                    Analysis indicates high resource availability with strong export potential to Japanese and Southeast Asian markets.
                </p>
            </div>

            <!-- Key Metrics Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                <div class="bg-white rounded-xl shadow-sm border border-stone-200 p-6 hover:shadow-md transition-shadow">
                    <div class="text-sm font-medium text-stone-500 mb-1">Internal Rate of Return (IRR)</div>
                    <div class="text-3xl font-bold text-profit">22.4%</div>
                    <div class="text-xs text-green-600 mt-2">‚ñ≤ Strong Viability</div>
                </div>
                <div class="bg-white rounded-xl shadow-sm border border-stone-200 p-6 hover:shadow-md transition-shadow">
                    <div class="text-sm font-medium text-stone-500 mb-1">Payback Period</div>
                    <div class="text-3xl font-bold text-stone-800">4.2 Years</div>
                    <div class="text-xs text-stone-400 mt-2">On 10 Year Project Life</div>
                </div>
                <div class="bg-white rounded-xl shadow-sm border border-stone-200 p-6 hover:shadow-md transition-shadow">
                    <div class="text-sm font-medium text-stone-500 mb-1">Break-even Catch</div>
                    <div class="text-3xl font-bold text-ocean">0.85 Tons</div>
                    <div class="text-xs text-stone-400 mt-2">Per operating day</div>
                </div>
                <div class="bg-white rounded-xl shadow-sm border border-stone-200 p-6 hover:shadow-md transition-shadow">
                    <div class="text-sm font-medium text-stone-500 mb-1">Total CAPEX</div>
                    <div class="text-3xl font-bold text-stone-800">‚Çπ 3.2 Cr</div>
                    <div class="text-xs text-stone-400 mt-2">Per Vessel (Fully Rigged)</div>
                </div>
            </div>
            
            <div class="bg-ocean-dark rounded-2xl p-8 text-white relative overflow-hidden">
                <div class="absolute top-0 right-0 text-9xl opacity-5 select-none pointer-events-none">üêü</div>
                <h3 class="text-2xl font-bold mb-4">Executive Summary</h3>
                <p class="text-ocean-light leading-relaxed max-w-4xl">
                    The Andaman & Nicobar waters offer a pristine, under-exploited stock of Yellowfin and Bigeye Tuna. 
                    Currently, the lack of specialized long-line vessels results in significant lost economic opportunity. 
                    This report validates that a modern 24m vessel, operating from Port Blair with proper cold-chain integration, 
                    can achieve sustainable profitability despite logistical overheads.
                </p>
            </div>
        </section>

        <!-- SECTION 2: Resource & Market Potential -->
        <section id="market" class="scroll-mt-20">
            <div class="border-l-4 border-ocean pl-4 mb-6">
                <h2 class="text-2xl font-bold text-stone-900">Resource Availability & Market Dynamics</h2>
                <p class="text-stone-600 mt-1">Understanding the biological asset and the target value chain.</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                
                <!-- Chart: Resource Potential -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-200">
                    <h3 class="text-lg font-semibold text-stone-800 mb-4">Tuna Stock Utilization (Andaman EEZ)</h3>
                    <p class="text-sm text-stone-500 mb-4">
                        The gap between the Maximum Sustainable Yield (MSY) and current catch levels represents the immediate business opportunity. 
                        Yellowfin Tuna shows the highest potential for expanded extraction.
                    </p>
                    <div class="chart-container">
                        <canvas id="resourceChart"></canvas>
                    </div>
                </div>

                <!-- Text Content: Market Logistics -->
                <div class="space-y-6">
                    <div class="bg-stone-100 p-6 rounded-xl">
                        <h3 class="text-lg font-semibold text-stone-800 mb-3">Target Species & Pricing</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <span class="font-medium text-stone-700">Yellowfin Tuna (Sashimi Grade)</span>
                                <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-bold">$12 - $18 / kg</span>
                            </div>
                            <div class="w-full bg-stone-200 rounded-full h-2">
                                <div class="bg-tuna-red h-2 rounded-full" style="width: 80%"></div>
                            </div>
                            
                            <div class="flex items-center justify-between mt-4">
                                <span class="font-medium text-stone-700">Bigeye Tuna (Frozen)</span>
                                <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-bold">$8 - $12 / kg</span>
                            </div>
                            <div class="w-full bg-stone-200 rounded-full h-2">
                                <div class="bg-ocean h-2 rounded-full" style="width: 60%"></div>
                            </div>

                            <div class="flex items-center justify-between mt-4">
                                <span class="font-medium text-stone-700">Bycatch (Marlin/Swordfish)</span>
                                <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-bold">$4 - $7 / kg</span>
                            </div>
                            <div class="w-full bg-stone-200 rounded-full h-2">
                                <div class="bg-profit h-2 rounded-full" style="width: 40%"></div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white border border-stone-200 p-6 rounded-xl">
                        <h3 class="text-lg font-semibold text-stone-800 mb-3">Logistical Flow</h3>
                        <div class="flex flex-col space-y-4">
                            <div class="flex items-start">
                                <span class="text-2xl mr-3">üé£</span>
                                <div>
                                    <div class="font-bold text-stone-800">Extraction</div>
                                    <div class="text-sm text-stone-600">Deep sea long-lining (15-20 days endurance). Onboard blast freezing (-60¬∞C).</div>
                                </div>
                            </div>
                            <div class="w-0.5 h-6 bg-stone-300 ml-3"></div>
                            <div class="flex items-start">
                                <span class="text-2xl mr-3">‚öì</span>
                                <div>
                                    <div class="font-bold text-stone-800">Landing @ Port Blair</div>
                                    <div class="text-sm text-stone-600">Offloading to cold storage. Sorting and grading for export vs domestic.</div>
                                </div>
                            </div>
                            <div class="w-0.5 h-6 bg-stone-300 ml-3"></div>
                            <div class="flex items-start">
                                <span class="text-2xl mr-3">‚úàÔ∏è</span>
                                <div>
                                    <div class="font-bold text-stone-800">Export Logistics</div>
                                    <div class="text-sm text-stone-600">Air cargo to Japan (Sashimi) / Container to Thailand (Canning).</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 3: Financial Simulator (Interactive) -->
        <section id="financials" class="scroll-mt-20">
            <div class="border-l-4 border-profit pl-4 mb-6">
                <h2 class="text-2xl font-bold text-stone-900">Interactive Viability Simulator</h2>
                <p class="text-stone-600 mt-1">Adjust key operational variables to see the impact on profitability. This model assumes a 24m vessel.</p>
            </div>

            <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
                
                <!-- Controls Panel -->
                <div class="bg-white p-6 rounded-xl shadow-lg border border-profit/20 h-fit">
                    <h3 class="text-lg font-bold text-stone-800 mb-6 flex items-center">
                        <span class="text-profit mr-2">‚öôÔ∏è</span> Operational Inputs
                    </h3>
                    
                    <!-- Input: Catch Rate -->
                    <div class="mb-6">
                        <label class="flex justify-between text-sm font-medium text-stone-700 mb-2">
                            Daily Catch Rate (Tons)
                            <span id="val-catch" class="text-ocean font-bold">1.2</span>
                        </label>
                        <input type="range" id="input-catch" min="0.5" max="2.5" step="0.1" value="1.2" 
                               class="w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-ocean">
                        <p class="text-xs text-stone-500 mt-1">Industry avg: 1.0 - 1.5 tons</p>
                    </div>

                    <!-- Input: Fuel Price -->
                    <div class="mb-6">
                        <label class="flex justify-between text-sm font-medium text-stone-700 mb-2">
                            Fuel Price (‚Çπ/Liter)
                            <span id="val-fuel" class="text-ocean font-bold">95</span>
                        </label>
                        <input type="range" id="input-fuel" min="70" max="130" step="1" value="95" 
                               class="w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-ocean">
                        <p class="text-xs text-stone-500 mt-1">HSD cost in Port Blair</p>
                    </div>

                    <!-- Input: Average Sale Price -->
                    <div class="mb-6">
                        <label class="flex justify-between text-sm font-medium text-stone-700 mb-2">
                            Avg. Sale Price ($/kg)
                            <span id="val-price" class="text-ocean font-bold">6.5</span>
                        </label>
                        <input type="range" id="input-price" min="3" max="12" step="0.5" value="6.5" 
                               class="w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-ocean">
                        <p class="text-xs text-stone-500 mt-1">Blended rate (Tuna + Bycatch)</p>
                    </div>

                    <!-- Input: Operating Days -->
                    <div class="mb-8">
                        <label class="flex justify-between text-sm font-medium text-stone-700 mb-2">
                            Operating Days / Year
                            <span id="val-days" class="text-ocean font-bold">220</span>
                        </label>
                        <input type="range" id="input-days" min="150" max="280" step="10" value="220" 
                               class="w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-ocean">
                    </div>

                    <div class="p-4 bg-stone-50 rounded-lg border border-stone-200">
                        <div class="text-xs font-semibold text-stone-500 uppercase tracking-wider mb-2">Projected Annual Profit</div>
                        <div id="output-profit" class="text-3xl font-bold text-profit">‚Çπ 0.00 Cr</div>
                        <div class="text-xs text-stone-400 mt-1">EBITDA</div>
                    </div>
                </div>

                <!-- Visualization Panel -->
                <div class="xl:col-span-2 space-y-6">
                    
                    <!-- Chart: 10 Year Cash Flow -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-200">
                        <h3 class="text-lg font-semibold text-stone-800 mb-2">10-Year Cumulative Cash Flow</h3>
                        <p class="text-sm text-stone-500 mb-4">Shows the break-even point and long-term capital accumulation based on your inputs.</p>
                        <div class="chart-container">
                            <canvas id="financialChart"></canvas>
                        </div>
                    </div>

                    <!-- Dynamic Stats Row -->
                    <div class="grid grid-cols-3 gap-4">
                        <div class="bg-white p-4 rounded-lg border border-stone-200 text-center">
                            <div class="text-xs text-stone-500">Calculated ROI</div>
                            <div id="output-roi" class="text-xl font-bold text-stone-800">0%</div>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-stone-200 text-center">
                            <div class="text-xs text-stone-500">Fuel Cost / Year</div>
                            <div id="output-fuel-cost" class="text-xl font-bold text-red-600">‚Çπ 0 L</div>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-stone-200 text-center">
                            <div class="text-xs text-stone-500">Revenue / Year</div>
                            <div id="output-revenue" class="text-xl font-bold text-green-600">‚Çπ 0 Cr</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 4: Risk Analysis (Plotly) -->
        <section id="risks" class="scroll-mt-20 pb-20">
             <div class="border-l-4 border-tuna-red pl-4 mb-6">
                <h2 class="text-2xl font-bold text-stone-900">Risk Sensitivity Analysis</h2>
                <p class="text-stone-600 mt-1">Visualizing how market volatility affects project viability.</p>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-200">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                    <div>
                        <h3 class="text-lg font-semibold text-stone-800">ROI Sensitivity Heatmap</h3>
                        <p class="text-sm text-stone-500">
                            X-Axis: Fuel Price Variation | Y-Axis: Fish Sale Price Variation. 
                            <br>Darker Blue = Higher ROI. Red = Negative ROI.
                        </p>
                    </div>
                </div>
                
                <div id="sensitivityChart" class="w-full h-[400px] md:h-[500px]"></div>
            </div>

            <!-- SWOT Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
                <div class="bg-stone-50 p-6 rounded-xl border border-stone-200">
                    <h4 class="font-bold text-stone-800 mb-3 flex items-center"><span class="text-green-600 mr-2">‚óè</span> Strengths</h4>
                    <ul class="text-sm text-stone-600 space-y-2 list-disc list-inside">
                        <li>Proximity to fishing grounds (low transit time).</li>
                        <li>High value species availability (Yellowfin).</li>
                        <li>Government subsidies for deep sea fishing vessels.</li>
                    </ul>
                </div>
                <div class="bg-stone-50 p-6 rounded-xl border border-stone-200">
                    <h4 class="font-bold text-stone-800 mb-3 flex items-center"><span class="text-red-600 mr-2">‚óè</span> Weaknesses</h4>
                    <ul class="text-sm text-stone-600 space-y-2 list-disc list-inside">
                        <li>Limited cold chain infrastructure at port.</li>
                        <li>High dependency on mainland for maintenance/spares.</li>
                        <li>High air freight costs for export.</li>
                    </ul>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-stone-900 text-stone-400 py-12">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="mb-4 text-lg font-semibold text-stone-200">Andaman Long Line Tuna Feasibility Study</p>
            <p class="text-sm mb-8">Generated Interactive Report based on Standard Fishery Economic Models.</p>
            <div class="flex justify-center gap-4 text-sm">
                <span>Data Source: Simulated Feasibility Data</span>
                <span>‚Ä¢</span>
                <span>Currency: INR / USD</span>
            </div>
        </div>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // === 1. NAVIGATION LOGIC ===
        function navigateTo(sectionId) {
            document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth' });
            
            // Update active tab styling
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('onclick').includes(sectionId)) {
                    btn.classList.add('active');
                }
            });
        }

        // === 2. DATA MODEL & STATE ===
        const state = {
            capex: 32000000, // 3.2 Cr
            catchRate: 1.2, // Tons per day
            fuelPrice: 95, // INR per liter
            avgPriceUSD: 6.5, // USD per kg
            days: 220,
            exchangeRate: 83, // INR to USD
            fuelConsumption: 1200 // Liters per day
        };

        // Static Data for Charts
        const resourceData = {
            labels: ['Yellowfin Tuna', 'Bigeye Tuna', 'Skipjack', 'Billfishes', 'Sharks'],
            potential: [24000, 1200, 18000, 3000, 1500], // Estimated Sustainable Yield
            current: [8000, 300, 5000, 500, 200] // Current Catch
        };

        // === 3. INITIALIZATION ===
        document.addEventListener('DOMContentLoaded', () => {
            initResourceChart();
            initFinancialChart();
            initSensitivityChart();
            updateCalculator(); // Initial calc

            // Attach Event Listeners to Inputs
            const inputs = ['input-catch', 'input-fuel', 'input-price', 'input-days'];
            inputs.forEach(id => {
                document.getElementById(id).addEventListener('input', (e) => {
                    handleInput(id, e.target.value);
                });
            });
        });

        function handleInput(id, value) {
            // Update UI Labels
            if(id === 'input-catch') { state.catchRate = parseFloat(value); document.getElementById('val-catch').innerText = value; }
            if(id === 'input-fuel') { state.fuelPrice = parseInt(value); document.getElementById('val-fuel').innerText = value; }
            if(id === 'input-price') { state.avgPriceUSD = parseFloat(value); document.getElementById('val-price').innerText = value; }
            if(id === 'input-days') { state.days = parseInt(value); document.getElementById('val-days').innerText = value; }

            updateCalculator();
        }

        // === 4. CHARTS IMPLEMENTATION ===

        let chartResource = null;
        let chartFinancial = null;

        function initResourceChart() {
            const ctx = document.getElementById('resourceChart').getContext('2d');
            chartResource = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: resourceData.labels,
                    datasets: [
                        {
                            label: 'Current Annual Catch (Tons)',
                            data: resourceData.current,
                            backgroundColor: '#94a3b8', // Slate-400
                            borderRadius: 4
                        },
                        {
                            label: 'Underexploited Potential (Tons)',
                            data: resourceData.potential.map((p, i) => p - resourceData.current[i]),
                            backgroundColor: '#0ea5e9', // Sky-500
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: { mode: 'index', intersect: false }
                    },
                    scales: {
                        x: { stacked: true, grid: { display: false } },
                        y: { stacked: true, beginAtZero: true, title: { display: true, text: 'Metric Tons' } }
                    }
                }
            });
        }

        function initFinancialChart() {
            const ctx = document.getElementById('financialChart').getContext('2d');
            chartFinancial = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 10}, (_, i) => `Year ${i+1}`),
                    datasets: [{
                        label: 'Cumulative Cash Flow (‚Çπ Cr)',
                        data: [], // Populated dynamically
                        borderColor: '#0284c7',
                        backgroundColor: 'rgba(2, 132, 199, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y.toFixed(2) + ' Cr';
                                }
                            }
                        },
                        annotation: {
                            annotations: {
                                line1: {
                                    type: 'line',
                                    yMin: 0,
                                    yMax: 0,
                                    borderColor: 'rgb(255, 99, 132)',
                                    borderWidth: 2,
                                    borderDash: [5, 5]
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            title: { display: true, text: 'Cumulative Profit (‚Çπ Cr)' }
                        }
                    }
                }
            });
        }

        function initSensitivityChart() {
            // Heatmap logic using Plotly
            // X: Fuel Price (70 - 120), Y: Sale Price (4 - 10)
            const fuelRange = [70, 80, 90, 100, 110, 120];
            const priceRange = [4, 5, 6, 7, 8, 9, 10];
            
            const zValues = []; // ROI values

            // Calculate ROI for each combination (Simplified logic)
            // Assuming constant catch of 1.2 tons and 220 days
            const baseCatch = 1.2 * 1000; // kg
            const baseDays = 220;
            const capex = 32000000;
            const fuelCons = 1200;

            for (let pIdx = 0; pIdx < priceRange.length; pIdx++) {
                let row = [];
                for (let fIdx = 0; fIdx < fuelRange.length; fIdx++) {
                    const price = priceRange[pIdx];
                    const fuel = fuelRange[fIdx];
                    
                    const rev = baseCatch * baseDays * price * 83;
                    const fuelC = fuelCons * baseDays * fuel;
                    const otherOpex = 6000000; // Fixed crew/maint
                    const profit = rev - (fuelC + otherOpex);
                    const roi = (profit / capex) * 100;
                    row.push(roi);
                }
                zValues.push(row);
            }

            const data = [{
                z: zValues,
                x: fuelRange.map(f => `‚Çπ${f}/L`),
                y: priceRange.map(p => `$${p}/kg`),
                type: 'heatmap',
                colorscale: 'RdBu', // Red (loss) to Blue (profit)
                zmin: -10,
                zmax: 50,
                hoverongaps: false,
                hovertemplate: 'Fuel: %{x}<br>Price: %{y}<br>ROI: %{z:.1f}%<extra></extra>'
            }];

            const layout = {
                margin: { t: 30, r: 30, l: 60, b: 60 },
                xaxis: { title: 'Fuel Price' },
                yaxis: { title: 'Fish Sale Price' },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };

            Plotly.newPlot('sensitivityChart', data, layout, {displayModeBar: false, responsive: true});
        }

        // === 5. CORE CALCULATOR LOGIC ===
        function updateCalculator() {
            // Calculations
            // Revenue
            const annualCatchKg = state.catchRate * 1000 * state.days;
            const annualRevenue = annualCatchKg * state.avgPriceUSD * state.exchangeRate;

            // OPEX
            const fuelCost = state.fuelConsumption * state.days * state.fuelPrice;
            const crewCost = 3500000; // Fixed estimate
            const maintCost = 1500000; // Fixed estimate
            const portIceBait = 2000000 + (state.days * 5000); // Variable
            const totalOpex = fuelCost + crewCost + maintCost + portIceBait;

            // EBITDA
            const ebitda = annualRevenue - totalOpex;
            const depreciation = state.capex * 0.1; // 10 year SL
            const netProfit = ebitda - depreciation; // Pre-tax

            // ROI
            const roi = (netProfit / state.capex) * 100;

            // Update DOM Text
            document.getElementById('output-profit').innerText = `‚Çπ ${(ebitda / 10000000).toFixed(2)} Cr`;
            document.getElementById('output-roi').innerText = `${roi.toFixed(1)}%`;
            document.getElementById('output-roi').className = `text-xl font-bold ${roi > 0 ? 'text-green-600' : 'text-red-600'}`;
            document.getElementById('output-fuel-cost').innerText = `‚Çπ ${(fuelCost / 100000).toFixed(1)} L`;
            document.getElementById('output-revenue').innerText = `‚Çπ ${(annualRevenue / 10000000).toFixed(2)} Cr`;

            // Update Financial Chart Data
            updateCashFlowChart(ebitda);
        }

        function updateCashFlowChart(annualEbitda) {
            if(!chartFinancial) return;

            const cashFlows = [];
            let cumulative = -state.capex; // Year 0

            for(let i=1; i<=10; i++) {
                // Assuming 5% cost increase and 2% price increase per year net effect roughly flat or slight growth, 
                // keeping simple linear for this demo
                cumulative += annualEbitda;
                cashFlows.push(cumulative / 10000000); // Convert to Cr
            }

            chartFinancial.data.datasets[0].data = cashFlows;
            
            // Color change based on profitability
            const isProfitable = cashFlows[9] > 0;
            chartFinancial.data.datasets[0].borderColor = isProfitable ? '#0284c7' : '#be123c';
            chartFinancial.data.datasets[0].backgroundColor = isProfitable ? 'rgba(2, 132, 199, 0.1)' : 'rgba(190, 18, 60, 0.1)';
            
            chartFinancial.update();
        }

    </script>
</body>
</html>